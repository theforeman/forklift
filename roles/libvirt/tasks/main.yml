---
- name: 'Set OS version dependent variables'
  ansible.builtin.include_vars: "el{{ ansible_distribution_major_version }}.yml"

- name: 'Install the virtualization hypervisor package group'
  ansible.builtin.yum:
    name: "@Virtualization Hypervisor"
    state: present

- name: 'Install the virtualization tools package group'
  ansible.builtin.yum:
    name: "@Virtualization Tools"
    state: present

- name: 'Install the libvirt-python support'
  ansible.builtin.yum:
    name: "{{ libvirt_python_deps }}"
    state: present

- name: 'Disable libvirt authentication'
  ansible.builtin.lineinfile:
    dest: /etc/libvirt/libvirtd.conf
    line: 'auth_unix_rw = "none"'

- name: Include nested.yml
  ansible.builtin.include_tasks: 'nested.yml'
  when: libvirt_nested

- name: 'Restart libvirt'
  ansible.builtin.service: name=libvirtd state=restarted

- name: Include tftp.yml
  ansible.builtin.include_tasks: 'tftp.yml'
  when: libvirt_tftp
