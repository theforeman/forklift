---
- name: make grub not care that it can't be installed
  debconf:
    name: grub-pc
    question: grub-pc/install_devices_empty
    value: 'true'
    vtype: boolean
  when:
    - ansible_os_family == 'Debian'

# workaround for https://github.com/lavabit/robox/issues/294
- name: clean up old Ubuntu initrds
  shell: rm -f /boot/*-generic.img
  when:
    - ansible_os_family == 'Debian'

# workaround for https://github.com/puppetlabs/puppet/issues/9268
- name: never install Puppet 7.29.0 on Debian
  copy:
    dest: /etc/apt/preferences.d/puppet.pref
    content: |
      Package: puppet-agent
      Pin: version 7.29.0*
      Pin-Priority: -10
  when:
    - ansible_os_family == 'Debian'

# workaround for https://github.com/puppetlabs/puppet/issues/9268
- name: never install Puppet 7.29.0 on EL
  community.general.ini_file:
    path: /etc/dnf/dnf.conf
    section: main
    option: excludepkgs
    value: 'puppet-agent-7.29.0*'
  when:
    - ansible_os_family == 'RedHat'
