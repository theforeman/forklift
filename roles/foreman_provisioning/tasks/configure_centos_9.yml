- name: 'Set templates fact'
  set_fact:
    templates:
      - kind: 'host_init_config'
        name: 'Linux host_init_config default'
      - kind: 'provision'
        name: 'Kickstart default'
      - kind: 'PXEGrub'
        name: 'Kickstart default PXEGrub'
      - kind: 'PXEGrub2'
        name: 'Kickstart default PXEGrub2'
      - kind: 'PXELinux'
        name: 'Kickstart default PXELinux'
      - kind: 'finish'
        name: 'Kickstart default finish'
      - kind: 'iPXE'
        name: 'Kickstart default iPXE'
      - kind: 'user_data'
        name: 'Kickstart default user data'

- name: "Ensure CentOS Stream 9" # noqa: args[module]
  theforeman.foreman.operatingsystem:
    name: CentOS_Stream
    family: Redhat
    major: 9
    architectures:
      - x86_64
    media:
      - CentOS Stream 9 mirror
    provisioning_templates: "{{ templates | map(attribute='name') }}"
    ptables:
      - Kickstart default
    state: present
    password_hash: "SHA256"

- name: "Set default templates for CentOS Stream 9" # noqa: args[module]
  theforeman.foreman.os_default_template:
    operatingsystem: "CentOS_Stream 9"
    template_kind: "{{ item.kind }}"
    provisioning_template: "{{ item.name }}"
    state: present
  loop: "{{ templates }}"
