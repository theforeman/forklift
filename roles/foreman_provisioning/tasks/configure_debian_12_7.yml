- name: "Find all relevant templates" # noqa: args[module]
  theforeman.foreman.resource_info:
    resource: provisioning_templates
    search: name ~ "Preseed default" or name = "Linux host_init_config default"
  register: result

- name: "Ensure Debian 12.7" # noqa: args[module]
  theforeman.foreman.operatingsystem:
    name: Debian
    family: Debian
    major: 12
    minor: 7
    release_name: bookworm
    architectures:
      - x86_64
    media:
      - Debian mirror
    provisioning_templates: "{{ result.resources | map(attribute='name') }}"
    ptables:
      - Preseed default
    state: present
    password_hash: "SHA256"

- name: "Set default template for Debian 12.7" # noqa: args[module]
  theforeman.foreman.os_default_template:
    operatingsystem: "Debian 12.7"
    template_kind: "{{ item.template_kind_name }}"
    provisioning_template: "{{ item.name }}"
    state: present
  loop: "{{ result.resources | sort(attribute='name') | unique(attribute='template_kind_name') }}"
