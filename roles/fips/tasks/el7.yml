---
- name: 'Install dracut-fips'
  package:
    name: dracut-fips
    state: present

- name: 'Run dracut to rebuild initramfs'
  command: dracut --force

- name: 'Get boot_uuid'
  command: 'findmnt -no uuid /boot'
  register: result

- name: 'Edit kernel command-line to include the fips=1 and boot=UUID=XXXX argument'
  shell: 'grubby --update-kernel=DEFAULT --args="fips=1 boot=UUID={{ result.stdout }}"'
